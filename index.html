<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Form Verlap II-3 - BSPS</title>
  <style>
    :root{
      --primary:#004953;
      --accent:#C3B091;
      --light:#f9f9f9;
      --dark:#333;
      --good:#d4edda;
      --medium:#fff3cd;
      --bad:#f8d7da;
    }
    *{box-sizing:border-box}
    body{
      font-family:"Segoe UI",Arial,sans-serif;
      margin:0;
      background:var(--light);
      color:var(--dark);
      -webkit-font-smoothing:antialiased;
    }
    header{
      background:var(--primary);
      color:#fff;
      text-align:center;
      padding:18px 12px;
    }
    header img{height:70px; display:block; margin:0 auto 8px}
    header h1{margin:0; font-size:20px}
    header p{margin:0; font-size:13px; color:var(--accent)}

    form{
      background:#fff;
      max-width:1100px;
      margin:24px auto;
      padding:22px;
      border-radius:12px;
      box-shadow:0 6px 16px rgba(0,0,0,0.08);
    }
    fieldset{
      margin-top:18px;
      padding:16px;
      border-radius:10px;
      border:2px solid var(--accent);
    }
    legend{font-weight:bold; color:var(--primary); padding:0 8px}
    label{font-weight:bold; color:var(--primary); display:block; margin-bottom:6px}
    input[type="text"], input[type="number"], select, textarea{
      width:100%;
      padding:6px 8px;
      border:1px solid #ccc;
      border-radius:6px;
      font-size:14px;
    }
    textarea{min-height:80px; resize:vertical}

    table{width:100%; border-collapse:collapse; margin-top:12px}
    th, td{border:1px solid #aaa; padding:8px; font-size:13px; vertical-align:top; text-align:left}
    th{background:var(--accent); color:var(--primary); text-align:center}
    .good{background:var(--good)}
    .medium{background:var(--medium)}
    .bad{background:var(--bad)}

    .file-name{display:block; margin-top:6px; font-size:12px; color:#555}

    button{
      margin-top:18px;
      width:100%;
      padding:14px;
      background:var(--primary);
      color:#fff;
      font-weight:700;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-size:16px;
    }
    button[disabled]{opacity:0.6; cursor:not-allowed}
    button:hover{background:var(--accent); color:var(--primary)}

    #loading{display:none; text-align:center; margin-top:10px; font-weight:700; color:var(--primary)}

    /* responsive: convert table to vertical blocks on small screens */
    @media (max-width:768px){
      th{display:none}
      table, thead, tbody, tr, td{display:block}
      td{border: none; border-bottom:1px solid #eee; padding:10px 6px}
      td > label{margin-bottom:6px}
      td:first-child{font-weight:700}
      header img{height:56px}
      header h1{font-size:18px}
      form{margin:12px; padding:16px}
    }
  </style>
</head>
<body>
  <header>
    <img src="1.png" alt="Logo KemenPKP">
    <h1>Form Verifikasi Penerima Bantuan (II-3)</h1>
    <p>Kementerian Perumahan dan Kawasan Permukiman</p>
  </header>

  <form id="verlapForm" enctype="multipart/form-data" autocomplete="off">
    <!-- Identitas -->
    <fieldset>
      <legend>Identitas</legend>
      <table>
        <tr>
          <td>Nama KK</td>
          <td><input type="text" name="nama" required></td>
          <td>Penghasilan KK per bulan (Rp)</td>
          <td><input type="number" name="penghasilan"></td>
        </tr>
        <tr>
          <td>NIK</td>
          <td><input type="text" name="nik"></td>
          <td>Nilai UMP / UMK (Rp)</td>
          <td><input type="number" name="ump"></td>
        </tr>
        <tr>
          <td>Nomor KK</td>
          <td><input type="text" name="kk"></td>
          <td>Pernah dapat BSPS</td>
          <td>
            <select name="pernah_bsps">
              <option>Ya</option>
              <option>Tidak</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>Jenis Kelamin</td>
          <td>
            <select name="jk">
              <option value="L">Laki-laki</option>
              <option value="P">Perempuan</option>
            </select>
          </td>
          <td>Tahun dapat BSPS</td>
          <td><input type="number" name="tahun_bsps" value="0"></td>
        </tr>
        <tr>
          <td>Umur</td><td><input type="number" name="umur"></td>
          <td>Berapa tahun menempati rumah</td><td><input type="number" name="tahun_huni"></td>
        </tr>
        <tr>
          <td>Alamat</td><td><input type="text" name="alamat"></td>
          <td>Memiliki aset rumah lainnya</td>
          <td>
            <select name="aset_rumah">
              <option>Ya</option>
              <option>Tidak</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>RT/RW</td><td><input type="text" name="rt_rw"></td>
          <td>Jumlah penghuni (jiwa)</td><td><input type="number" name="jml_penghuni"></td>
        </tr>
        <tr>
          <td>Desa/Kelurahan</td><td><input type="text" name="desa"></td>
          <td>Luas rumah (m²)</td><td><input type="number" name="luas_rumah" step="0.1"></td>
        </tr>
        <tr>
          <td>Kecamatan</td><td><input type="text" name="kecamatan"></td>
          <td>Bersedia mengikuti program</td>
          <td>
            <select name="bersedia">
              <option>Ya</option>
              <option>Tidak</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>Kabupaten/Kota</td><td><input type="text" name="kabupaten"></td>
          <td>Titik koordinat</td><td><input type="text" name="koordinat" placeholder="lat,long"></td>
        </tr>
        <tr>
          <td>Provinsi</td><td><input type="text" name="provinsi"></td>
          <td></td><td></td>
        </tr>
      </table>
    </fieldset>

    <!-- Checklist -->
    <fieldset>
      <legend>Checklist Kondisi Rumah</legend>
      <table>
        <tr>
          <th>Aspek/Komponen</th>
          <th class="good">A</th>
          <th class="medium">B</th>
          <th class="bad">C</th>
        </tr>

        <tr><td><b>1. STRUKTUR</b></td><td colspan="3"></td></tr>

        <tr>
          <td>Pondasi</td>
          <td class="good"><input type="radio" name="pondasi" value="A"> ada, kondisi baik, kokoh</td>
          <td class="medium"><input type="radio" name="pondasi" value="B"> ada, sebagian rapuh, tidak kokoh</td>
          <td class="bad"><input type="radio" name="pondasi" value="C"> tidak ada, seluruhnya rapuh</td>
        </tr>

        <tr>
          <td>Sloof</td>
          <td class="good"><input type="radio" name="sloof" value="A"> ada, kondisi baik, kokoh</td>
          <td class="medium"><input type="radio" name="sloof" value="B"> ada, sebagian rapuh, tidak kokoh</td>
          <td class="bad"><input type="radio" name="sloof" value="C"> tidak ada, seluruhnya rapuh</td>
        </tr>

        <tr>
          <td>Kolom</td>
          <td class="good"><input type="radio" name="kolom" value="A"> ada, kondisi baik, kokoh</td>
          <td class="medium"><input type="radio" name="kolom" value="B"> ada, sebagian rapuh, tidak kokoh</td>
          <td class="bad"><input type="radio" name="kolom" value="C"> tidak ada, seluruhnya rapuh</td>
        </tr>

        <tr>
          <td>Ring Balok</td>
          <td class="good"><input type="radio" name="ring_balok" value="A"> ada, kondisi baik, kokoh</td>
          <td class="medium"><input type="radio" name="ring_balok" value="B"> ada, sebagian rapuh, tidak kokoh</td>
          <td class="bad"><input type="radio" name="ring_balok" value="C"> tidak ada, seluruhnya rapuh</td>
        </tr>

        <tr>
          <td>Rangka Atap</td>
          <td class="good"><input type="radio" name="rangka_atap" value="A"> ada, kondisi baik, kokoh</td>
          <td class="medium"><input type="radio" name="rangka_atap" value="B"> ada, sebagian rapuh, tidak kokoh</td>
          <td class="bad"><input type="radio" name="rangka_atap" value="C"> tidak ada, seluruhnya rapuh</td>
        </tr>

        <tr><td><b>2. NON-STRUKTUR</b></td><td colspan="3"></td></tr>

        <tr>
          <td>Dinding</td>
          <td class="good"><input type="radio" name="dinding" value="A"> Tembok/setengah tembok diplester, papan kayu berkualitas</td>
          <td class="medium"><input type="radio" name="dinding" value="B"> tembok kondisi sebagian besar retak / papan lain kurang kokoh</td>
          <td class="bad"><input type="radio" name="dinding" value="C"> anyaman bambu, triplek, papan tipis, rapuh</td>
        </tr>

        <tr>
          <td>Lantai</td>
          <td class="good"><input type="radio" name="lantai" value="A"> Plester/ubin/keramik/papan kondisi baik</td>
          <td class="medium"><input type="radio" name="lantai" value="B"> papan/bahan lain rusak, plester sebagian pecah</td>
          <td class="bad"><input type="radio" name="lantai" value="C"> tanah / papan rapuh</td>
        </tr>

        <tr>
          <td>Penutup Atap</td>
          <td class="good"><input type="radio" name="penutup_atap" value="A"> genteng/seng/spandek kondisi baik</td>
          <td class="medium"><input type="radio" name="penutup_atap" value="B"> kondisi rusak sebagian, bisa bocor saat hujan lebat</td>
          <td class="bad"><input type="radio" name="penutup_atap" value="C"> asbes/bahan rusak berat, sering bocor</td>
        </tr>

        <tr><td><b>3. KESEHATAN & KECUKUPAN LUAS</b></td><td colspan="3"></td></tr>

        <tr>
          <td>Akses Air Minum</td>
          <td class="good"><input type="radio" name="air_minum" value="A"> Ada</td>
          <td class="medium"></td>
          <td class="bad"><input type="radio" name="air_minum" value="C"> Tidak ada</td>
        </tr>

        <tr>
          <td>Akses Sanitasi</td>
          <td class="good"><input type="radio" name="sanitasi" value="A"> Ada</td>
          <td class="medium"></td>
          <td class="bad"><input type="radio" name="sanitasi" value="C"> Tidak ada</td>
        </tr>

        <tr>
          <td>Pencahayaan</td>
          <td class="good"><input type="radio" name="pencahayaan" value="A"> Ada, memenuhi syarat</td>
          <td class="medium"><input type="radio" name="pencahayaan" value="B"> Ada, tidak memenuhi syarat</td>
          <td class="bad"><input type="radio" name="pencahayaan" value="C"> Tidak ada ventilasi</td>
        </tr>

        <tr>
          <td>Penghawaan</td>
          <td class="good"><input type="radio" name="penghawaan" value="A"> Ada, memenuhi syarat</td>
          <td class="medium"><input type="radio" name="penghawaan" value="B"> Ada, tidak memenuhi syarat</td>
          <td class="bad"><input type="radio" name="penghawaan" value="C"> Tidak ada ventilasi</td>
        </tr>

        <tr>
          <td>Kecukupan Luas Ruang</td>
          <td class="good"><input type="radio" name="luas" value="A"> ≥ 7.2 m²/jiwa</td>
          <td class="medium"><input type="radio" name="luas" value="B"> < 7.2 m²/jiwa</td>
          <td class="bad"></td>
        </tr>

        <tr><td><b>4. STATUS LAHAN</b></td><td colspan="3"></td></tr>

        <tr>
          <td>Status Penguasaan Lahan</td>
          <td class="good"><input type="radio" name="status_lahan" value="A"> Milik sendiri (bukti sah)</td>
          <td class="medium"><input type="radio" name="status_lahan" value="B"> Sewa/menumpang (bukti sah)</td>
          <td class="bad"><input type="radio" name="status_lahan" value="C"> Tanpa bukti sah / ilegal</td>
        </tr>
      </table>
    </fieldset>

    <!-- Upload Foto -->
    <fieldset>
      <legend>Upload Dokumen & Foto</legend>
      <table>
        <tr><td>Foto KTP</td><td><input type="file" name="foto_ktp" accept="image/*" capture="environment" required><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Foto KK</td><td><input type="file" name="foto_kk" accept="image/*" capture="environment" required><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>TFL Selfi Depan Rumah</td><td><input type="file" name="tfl_selfi" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Foto Tampak Depan</td><td><input type="file" name="foto_depan" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Foto Tampak Menyamping</td><td><input type="file" name="foto_menyamping" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Foto Tampak Kiri</td><td><input type="file" name="foto_kiri" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Foto Tampak Kanan</td><td><input type="file" name="foto_kanan" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Foto Tampak Belakang</td><td><input type="file" name="foto_belakang" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Denah</td><td><input type="file" name="denah" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Fondasi</td><td><input type="file" name="fondasi" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Sloof / Balok Bawah</td><td><input type="file" name="sloof_foto" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Kolom</td><td><input type="file" name="kolom_foto" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Ring Balok</td><td><input type="file" name="ring_balok_foto" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Rangka Atap</td><td><input type="file" name="rangka_atap_foto" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Dinding</td><td><input type="file" name="dinding_foto" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Lantai</td><td><input type="file" name="lantai_foto" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Penutup Atap</td><td><input type="file" name="penutup_atap_foto" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Akses Air Minum</td><td><input type="file" name="akses_air" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Akses Sanitasi</td><td><input type="file" name="akses_sanitasi" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Pencahayaan & Penghawaan</td><td><input type="file" name="pencahayaan_penghawaan" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Kayu</td><td><input type="file" name="kayu" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Balok Kayu</td><td><input type="file" name="balok_kayu" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Kusen</td><td><input type="file" name="kusen" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Daun Pintu</td><td><input type="file" name="daun_pintu" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Jendela</td><td><input type="file" name="jendela" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Genteng</td><td><input type="file" name="genteng" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Batu Bata</td><td><input type="file" name="batu_bata" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Lainnya</td><td><input type="file" name="lainnya" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Kayu (Material)</td><td><input type="file" name="material_kayu" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Genteng (Material)</td><td><input type="file" name="material_genteng" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Batu Bata (Material)</td><td><input type="file" name="material_batubata" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Pasir</td><td><input type="file" name="pasir" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Kerikil</td><td><input type="file" name="kerikil" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
        <tr><td>Lainnya (Material)</td><td><input type="file" name="material_lain2" accept="image/*" capture="environment"><span class="file-name" aria-hidden></span></td></tr>
      </table>
    </fieldset>

    <button type="submit" id="submitBtn">Kirim Data</button>
    <div id="loading">⏳ Mengirim data, mohon tunggu...</div>
  </form>

  <script>
    (function(){
      const form = document.getElementById('verlapForm');
      const loading = document.getElementById('loading');
      const submitBtn = document.getElementById('submitBtn');

      // TODO: ganti ini dengan URL Web App dari Google Apps Script-mu
      const scriptURL = "PASTE_YOUR_APPS_SCRIPT_URL";

      // tampilkan nama file terpilih di sebelah input file
      document.querySelectorAll('input[type="file"]').forEach(input => {
        const span = input.parentElement.querySelector('.file-name');
        input.addEventListener('change', () => {
          if (!span) return;
          if (input.files && input.files.length > 0) {
            const names = Array.from(input.files).map(f => f.name).join(', ');
            span.textContent = names;
          } else {
            span.textContent = '';
          }
        });
      });

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // validasi sederhana: KTP & KK wajib
        const fileKTP = form.querySelector('input[name="foto_ktp"]');
        const fileKK = form.querySelector('input[name="foto_kk"]');
        if (!fileKTP || !fileKTP.files.length) {
          alert('Mohon unggah Foto KTP (wajib).');
          fileKTP && fileKTP.focus();
          return;
        }
        if (!fileKK || !fileKK.files.length) {
          alert('Mohon unggah Foto KK (wajib).');
          fileKK && fileKK.focus();
          return;
        }

        const formData = new FormData(form);

        // disable UI
        loading.style.display = 'block';
        submitBtn.disabled = true;

        try {
          const res = await fetch(scriptURL, { method: 'POST', body: formData });
          const txt = await res.text();
          loading.style.display = 'none';
          submitBtn.disabled = false;

          // beberapa Apps Script mengembalikan teks "SUCCESS" atau JSON {"result":"success"}
          let ok = false;
          try {
            const parsed = JSON.parse(txt);
            if (parsed && (parsed.result === 'success' || parsed.status === 'success')) ok = true;
          } catch(err) { /* not json */ }

          if (!ok && typeof txt === 'string' && txt.toLowerCase().includes('success')) ok = true;

          if (ok) {
            alert('✅ Data berhasil dikirim!');
            form.reset();
            // kosongkan file name displays
            document.querySelectorAll('.file-name').forEach(s => s.textContent = '');
            window.scrollTo({ top: 0, behavior: 'smooth' });
          } else {
            alert('❌ Gagal mengirim data. Respon server:\n' + txt);
            console.warn('Server response:', txt);
          }
        } catch (err) {
          loading.style.display = 'none';
          submitBtn.disabled = false;
          alert('⚠️ Terjadi error saat mengirim: ' + (err.message || err));
          console.error(err);
        }
      });
    })();
  </script>
</body>
</html>
